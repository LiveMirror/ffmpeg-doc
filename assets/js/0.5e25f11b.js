(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{152:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),s("p",[t._v("express-ffmpeg云转码依赖于服务器环境，需要安装nodejs、mongodb、ffmpeg及nginx等，所以本教程力图尽量详尽的列出安装步骤。")]),t._m(1),t._m(2),s("p",[t._v("Ubuntu16.04安装ffmpeg十分方便")]),t._m(3),s("p",[t._v("安装之后，命令行运行ffmpeg即可查看效果。")]),t._m(4),s("p",[t._v("假如是root账号登陆，系统为ubuntu16.04。")]),t._m(5),s("p",[t._v("配置终端启动时自动执行source /root/git/nvm/nvm.sh，在 ~/.bashrc、 ~/.bash_profile、~/.profile 或者 ~/.zshrc 文件添加以下命令:")]),t._m(6),s("p",[t._v("然后重新打开终端，输入nvm。")]),t._m(7),s("p",[t._v("如若显示类似内容，则nvm安装成功。")]),s("p",[t._v("查看最近nodejs稳定版本号，前往"),s("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejs官网"),s("OutboundLink")],1),t._v("，查看稳定版本号。截止此教程发布，最新的稳定版本为8.11.3，于是我们安装这个版本：")]),t._m(8),s("p",[t._v("最后设置默认版本")]),t._m(9),s("p",[t._v("这样每次重启，都会自动切换到nodejs v8.11.3版本。")]),t._m(10),s("p",[t._v("express-ffmpeg云转码自豪利用expressjs进行开发，我们进行全局安装即可。")]),t._m(11),t._m(12),s("p",[t._v("我们以最新的4.0版本为例。")]),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),s("p",[t._v("进入根目录创建data文件夹，在data中再创建db文件夹和log文件夹。")]),t._m(22),s("p",[t._v("然后利用命令行运行mongodb")]),t._m(23),s("p",[t._v("进入mongo命令行工具增加用户")]),t._m(24),s("p",[t._v("如果显示1则增加用户正确。")]),s("p",[t._v("关闭mongodb服务")]),t._m(25),s("p",[t._v("最后用命令行重启mongodb服务")]),t._m(26),s("p",[t._v("当然你也可以把这个写进mongodb的配置文件，然后利用配置文件启动mongodb。")]),t._m(27),t._m(28),s("p",[t._v("安装之后，我们需要配置nginx，进入/etc/nginx，我们需要关注的主要是两个文件夹，sites-available和sites-enabled，这两个文件夹里边的文件内容完全相同，这是因为site-available中的文件建立了符号链接到sites-enabled中文件，相当于快捷方式。我们开始设置我们自己的站点。")]),t._m(29),t._m(30),s("p",[t._v("开始配置yourdomain.com设置反向代理")]),t._m(31),s("p",[t._v("最后重启nginx服务")]),t._m(32),t._m(33),s("p",[t._v("环境装完了，现在开始安装云转码应用。\n假设将云转码安装在根目录/www中，如若没有此文件夹，请先创建。")]),t._m(34),s("p",[t._v("创建config文件夹，创建auth.js配置文件")]),t._m(35),s("p",[t._v("进行auth.js的配置")]),t._m(36),s("p",[t._v("从上往下依次是登陆云转码平台的账号，密码，数据库，数据库用户名，数据库密码。本教程安装的mongodb数据库为ffmpeg，用户名和密码都是ffmpeg，可以自行进行修改。")]),t._m(37),t._m(38),s("p",[t._v("pm2是极其推崇的运行nodejs应用的工具，-i 0的意思是以集群方式按照cpu线程数自动开启多线程运行，大幅提高运行效率。")]),t._m(39),s("p",[t._v("最后设置node运行环境为发行环境，并且重启服务，设置成发行环境会让应用速度更上一个台阶，并且不再显示错误信息。")]),t._m(40)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"安装教程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装教程","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装教程")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),e("p",[this._v("注意：下面的教程以Ubuntu16.04系统为例，其他系统步骤相同，安装方法不同而已。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装ffmpeg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装ffmpeg","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装ffmpeg")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("sudo add-apt-repository ppa:djcj/hybrid\nsudo apt-get update  \nsudo apt-get install ffmpeg \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装nvm及nodejs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装nvm及nodejs","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装nvm及nodejs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd ~\nmkdir git\ngit clone https://github.com/cnpm/nvm.git\nsource /root/git/nvm/nvm.sh\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("source /root/git/nvm/nvm.sh​\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ nvm\n \nNode Version Manager\n \nUsage:\n    nvm help                    Show this message\n    nvm --version               Print out the latest released version of nvm\n    nvm install [-s]   Download and install a , [-s] from source\n    nvm uninstall      Uninstall a version\n    nvm use            Modify PATH to use \n    nvm run  []  Run  with  as arguments\n    nvm current                 Display currently activated version\n    nvm ls                      List installed versions\n    nvm ls             List versions matching a given description\n    nvm ls-remote               List remote versions available for install\n    nvm deactivate              Undo effects of NVM on current shell\n    nvm alias []       Show all aliases beginning with \n    nvm alias    Set an alias named  pointing to \n    nvm unalias           Deletes the alias named \n    nvm copy-packages  Install global NPM packages contained in  to current version\n \nExample:\n    nvm install v0.10.24        Install a specific version number\n    nvm use 0.10                Use the latest available 0.10.x release\n    nvm run 0.10.24 myApp.js    Run myApp.js using node v0.10.24\n    nvm alias default 0.10.24   Set default node version on a shell\n \nNote:\n    to remove, delete or uninstall nvm - just remove ~/.nvm, ~/.npm and ~/.bower folders\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("nvm install 8.11.3\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("nvm alias default v8.11.3\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装expressjs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装expressjs","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装expressjs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("npm install express -gd\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装mongodb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装mongodb","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装mongodb")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"导入pulickey"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#导入pulickey","aria-hidden":"true"}},[this._v("#")]),this._v(" 导入pulickey")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"创建列表文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建列表文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建列表文件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"更新apt包数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新apt包数据库","aria-hidden":"true"}},[this._v("#")]),this._v(" 更新apt包数据库")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("sudo apt-get update\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"apt安装mongodb包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apt安装mongodb包","aria-hidden":"true"}},[this._v("#")]),this._v(" apt安装mongodb包")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("sudo apt-get install -y mongodb-org\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"mongodb数据库配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mongodb数据库配置","aria-hidden":"true"}},[this._v("#")]),this._v(" mongodb数据库配置")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd /\nmkdir data\ncd data\nmkdir db\nmkdir log\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("mongod --dbpath /data/db --fork --logpath /data/log/mongodb.log\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('mongo\nuse admin\nuse ffmpeg\ndb.createUser({user:"ffmpeg",pwd:"ffmpeg",roles:[{role:"readWrite",db:"ffmpeg"}]})\ndb.auth("ffmpeg","ffmpeg")\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("ps -ef | grep mongo\nmongo    18288     1  0 06:12 ?        00:00:00 mongod -f /database/mongodb/data/mongodb_27017.conf\nkill 18288\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("mongod -auth --bind_ip 127.0.0.1 --port 27017 --dbpath /data/db --fork --logpath /data/log/mongodb.log\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装-nginx-及反向代理配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-nginx-及反向代理配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装 nginx 及反向代理配置")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("sudo -s\nnginx=stable # use nginx=development for latest development version\nadd-apt-repository ppa:nginx/$nginx\napt-get update\napt-get install nginx\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),e("p",[this._v("符号链接(symbolic links): 克服硬链接的局限性, 类似于快捷方式, 使用与硬链接相同.\n如果先删除文件, 则会成为坏链接(broken), ls会以不同颜色(Ubuntu, 红色)显示\n操作: ln -s item link, 可以link文件和目录")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd /etc/nginx/sites-available\ncp default yourdomain.com\nln -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/yourdomain.com\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("server {  \n  server_name yourdomain.com;\n  listen 80;\n \n  location / {\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-NginX-Proxy true;\n    proxy_pass http://127.0.0.1:3000;\n    proxy_redirect off;\n  }\n}\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("/etc/init.d/nginx restart\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"克隆云转码源码并配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#克隆云转码源码并配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 克隆云转码源码并配置")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd /www\ngit clone https://gitee.com/quazero/express-ffmpeg\ncd express-ffmpeg\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("mkdir config\ncd config\ntouch auth.js\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('module.exports = {\n    user: "admin",\n    password: "admin",\n    db: "ffmpeg",\n    dbuser: "ffmpeg",\n    dbpassword: "ffmpeg"\n};\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装pm2并运行源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装pm2并运行源码","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装pm2并运行源码")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd /www/express-ffmpeg\nnpm install\nnpm install -g pm2\npm2 start bin/www -i 0\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"设置环境为发行环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置环境为发行环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 设置环境为发行环境")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("export NODE_ENV=production\npm2 reload all --update-env\n")])])])}],!1,null,null,null);e.default=n.exports}}]);